TelegramBot - 智能群聊管理机器人
[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/ysehertz/TelegramBot)
===

一个功能丰富的 Telegram 群聊管理机器人，提供用户积分系统、活动管理、消息队列处理和智能内容过滤等功能。

🚀 主要功能
---

### 📊 用户积分与成就系统

- **多维度积分计算**：支持文本消息、签到、回复、反应等多种活动类型的积分统计 Updates.md:153-203
- **全局成就系统**：包括签到达人、消息专家、互动专家等成就类别
- **积分排名**：支持分页显示活动积分排名，管理员可查看详细统计

### 🎯 活动管理

- **活动创建**：管理员可创建带有开始/结束时间的积分活动
- **自动积分聚合**：基于用户活动和成就加成计算最终积分
- **活动状态跟踪**：支持未开始、进行中、已结束的活动状态管理

### 📨 智能消息处理

- **按 Session 分队列管理**：优化消息处理性能，支持并行处理不同用户会话 Updates.md:3-92
- **FIFO 时序保证**：确保消息按时间顺序正确处理 Updates.md:203-243
- **群聊回复白名单**：精细化控制机器人在不同群聊中的回复行为 Updates.md:93-152

### 🛡️ 内容安全防护

- **广告消息过滤**：自动检测和处理违规广告内容 Updates.md:297-403
- **智能文本清理**：去除干扰字符，提高检测准确性
- **自动处理机制**：违规消息撤回、用户临时限制权限、管理员通知 Updates.md:468-538

### 🤖 AI 互动功能

- **功能开关控制**：管理员可统一控制 AI 互动功能的启用状态 Updates.md:244-296
- **智能问答**：支持 @机器人回复和自动回答用户问题
- **活动提醒**：自动生成活动相关的提醒和总结

🏗️ 技术架构
---

### 核心组件

- **消息队列系统**：基于 `ConcurrentHashMap<String, ConcurrentLinkedDeque>` 的分 Session 队列管理
- **积分计算引擎**：支持基础积分、成就加成和特殊积分的多因子计算
- **数据持久化**：SQLite 数据库存储用户数据、积分记录和活动信息

### 数据库表结构

- `user_points` - 用户积分记录
- `user_achievements` - 用户成就数据
- `user_activity_logs` - 用户活动日志
- `event_records` - 活动记录
- `admin_user` - 管理员权限
- `res_group` - 回复白名单

📋 管理员命令
---

### 积分与活动管理

- `/pointList` - 查看所有活动列表
- `/pointList <活动ID>` - 查看指定活动积分排名
- `/addEvent` - 创建新活动（引导式创建流程）
- `/addPoints` - 为用户添加特殊积分

### 群聊管理

- `/beginres` - 启用当前群聊的回复功能
- `/stopres` - 禁用当前群聊的回复功能
- `/checkres` - 查看当前群聊的回复状态

### AI 功能控制

- `/toggleai` - 切换 AI 互动功能开关
- `/aistatus` - 查看 AI 互动功能状态

### 系统管理

- `/initChat` - 初始化群聊设置
- `/initAdminGroup` - 初始化管理员群组

⚙️ 配置说明
---

### 消息队列配置

```
bot:  
  message-queue:  
    max-size: 500           # 总消息队列最大容量  
    max-session-size: 100   # 单个session队列最大容量    
    poll-interval: 60       # 队列轮询间隔（秒）  
    batch-size: 10          # 批处理大小
```

### AI 功能配置

```
bot-config:  
  aiInteraction: false      # AI互动功能开关，默认关闭
```

### 安全配置

```
bot:  
  forbidUrl: "path/to/forbidden-words.txt"  # 禁止词文件路径
```

🔧 部署与运行
---

1. 环境要求
   - Java 8+
   - SQLite 数据库
   - Telegram Bot Token
2. 配置文件
   - 配置 `application.yml` 中的机器人 Token 和相关参数
   - 设置禁止词文件路径（可选）
3. 数据库初始化
   - 应用启动时会自动创建所需的数据库表
4. 管理员设置
   - 首次运行后，需要手动添加管理员用户到 `admin_user` 表

📈 性能特性
---

- ✅ **高并发处理**：按 Session 分队列，支持多用户并行处理
- ✅ **内存优化**：自动清理空队列，防止内存泄漏
- ✅ **时序保证**：FIFO 队列确保消息处理顺序
- ✅ **背压控制**：多级队列容量限制，防止系统过载
- ✅ **可观测性**：详细的日志记录和状态监控

🛠️ 最近更新
---

项目持续更新中，最新功能包括： Updates.md:3-6

- 消息队列架构优化（按 SessionId 分队列管理）
- 群聊回复白名单功能
- 管理员积分排名查看功能
- AI 互动功能开关控制
- 广告消息过滤与安全防护

Notes
---

这个 README.md 基于项目的 `Updates.md` 文件内容编写，涵盖了项目的主要功能特性、技术架构和使用方法。 Updates.md:1-360 项目采用 Java 开发，使用 Telegram Bot API，具有完整的用户积分系统、活动管理、消息处理和安全防护功能。