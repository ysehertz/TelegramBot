# /addpoints 指令说明

## 功能描述
`/addpoints` 指令用于为指定用户添加或扣减特殊积分。

## 使用方法
```
/addpoints <数字> @用户名
```

## 参数说明
- `<数字>`: 要添加或扣减的特殊积分数量，必须是整数
  - 正数：添加特殊积分
  - 负数：扣减特殊积分
- `@用户名`: 目标用户的用户名，支持带@符号或不带@符号

## 使用示例
```
/addpoints 10 @fuchen     # 为fuchen添加10特殊积分
/addpoints -5 @naseele    # 为naseele扣减5特殊积分
/addpoints 0 @test        # 不改变test的积分（但会记录操作日志）
```

## 权限要求
- 需要管理员权限 (Privacy.ADMIN)
- 可在任何群聊中使用 (Locality.ALL)

## 功能流程
1. 解析命令参数（积分数量和用户名）
2. 通过用户名在 `user_achievements` 表中查找对应的用户ID
3. 获取当前群聊的所有活跃活动
4. 为该用户在所有活跃活动中添加或扣减指定的特殊积分
5. **注意：只有用户在该活动中已有积分记录的情况下才会添加特殊积分，如果用户在某个活动中没有积分记录，则跳过该活动**
6. 返回操作结果

## 错误处理
- 参数不足：显示正确的使用方法
- 积分数量不是数字：提示积分数量必须是数字
- 用户不存在：提示未找到该用户
- 没有活跃活动：提示当前群聊没有活跃的活动
- 用户在所有活动中都没有积分记录：提示无法添加特殊积分
- 系统异常：显示操作失败信息

## 数据库操作
- 查询表：`user_achievements` (通过用户名查找用户ID)
- 更新表：`user_points` (添加或扣减特殊积分，仅当用户已有记录时)

## 业务逻辑
- **重要**：该指令不会为用户创建新的积分记录
- 只会为已有积分记录的用户增加或减少特殊积分
- 如果用户在某些活动中没有积分记录，会跳过这些活动并在结果中说明
- **积分扣减**：支持负数参数来扣减积分，系统会自动识别并在消息中显示"扣减"而非"添加"

## 日志记录
成功操作会记录到系统日志中，包含操作类型、用户ID和操作详情。日志会根据积分正负值显示"添加"或"扣减"操作。 